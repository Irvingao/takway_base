Takway.AI
=========

### ğŸƒé¢å‘è§’è‰²æ‰®æ¼”åŠŸèƒ½çš„å¤šæ¨¡æ€äº¤äº’ç³»ç»ŸğŸ¤– [[é£ä¹¦Link](https://lleeei6t29.feishu.cn/docx/BzVWd57K9oyVSixhTamcv4tSnHf)]

- ğŸ¦¾å‰ç«¯ï¼šåŸºäºLinuxç«¯ä¾§å¹³å°çš„è¯­éŸ³ã€è§†è§‰äº¤äº’ç³»ç»Ÿï¼Œå¯ä»¥å®ç°è¯­éŸ³å”¤é†’ã€è¯­éŸ³è¾“å…¥ã€è¯­éŸ³æ’­æ”¾ã€è¡¨æƒ…äº’åŠ¨ç­‰åŠŸèƒ½ã€‚å…¶ä¸­è¯­éŸ³è¾“å…¥æ¡†æ¶å¦‚å›¾æ‰€ç¤ºï¼š

![å‰ç«¯](docs/images/frontend-audio-pipeline.png)

- ğŸ–²ï¸åç«¯ï¼šåŸºäºPython Flaskæ¡†æ¶çš„åç«¯è¯­éŸ³è¯†åˆ«æœåŠ¡ï¼Œå¯ä»¥å®ç°æµå¼è¯­éŸ³è¯†åˆ«ã€å¤§æ¨¡å‹æµå¼ç”Ÿæˆã€æµå¼è¯­éŸ³åˆæˆç­‰åŠŸèƒ½ã€‚åç«¯å¤šè¿›ç¨‹æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

      å¾…æ›´æ–°...

<!-- ![åç«¯](docs/images/backend-framework.png) -->

---

### ğŸ“†é¡¹ç›®æ›´æ–°æ—¥å¿—


<details>
<summary>ç‚¹å‡»å±•å¼€æ›´æ–°æ—¥å¿—</summary>

- **2024.4.8**ï¼š
  1. å®Œæˆåç«¯æœåŠ¡FastAPIçš„ä¸­æ•°æ®åº“åŠŸèƒ½æ­å»ºã€‚
- **2024.4.6**ï¼š
  1. å®Œæˆåˆç‰ˆFastAPIåç«¯æœåŠ¡æ­å»ºã€‚
- **2024.3.21**ï¼š
  1. å®ŒæˆåŸºäº[bida](https://github.com/xusenlinzy/bida)çš„å•†ä¸šæ¨¡å‹APIæ¥å…¥ã€‚
- **2024.3.14**ï¼š
  1. æ¥å…¥[api-for-open-llm](https://github.com/xusenlinzy/api-for-open-llm)ï¼Œæ”¯æŒæœ¬åœ°éƒ¨ç½²æ¨¡å‹ï¼Œå¹¶ç»Ÿä¸€æ¨¡å‹æœåŠ¡APIæ¥å£ã€‚
- **2024.3.13**ï¼š
  1. æ¥å…¥[FunASR](https://github.com/alibaba-damo-academy/FunASR)ï¼Œæ”¯æŒ[modelscope](https://www.modelscope.cn/)ä¸Šç™¾ç§å¤šè¯­è¨€è¯­éŸ³è¯†åˆ«æ¨¡å‹ã€‚
- **2024.3.1**ï¼š
  1. é¡¹ç›®å‘å¸ƒğŸ”¥ğŸ”¥ğŸ”¥ğŸš€ğŸš€ğŸš€ï¼
- **2024.2.27**ï¼š
  1. è°ƒè¯•å¹¶ç¡®è®¤å®Œæˆå‰åç«¯é€šä¿¡æ•°æ®æ ¼å¼ï¼›
  2. åˆæ­¥ç¡®è®¤å¤§æ¨¡å‹è§’è‰²æ‰®æ¼”ç³»ç»Ÿè¿è¡Œã€‚
- **2024.2.26**ï¼š
  1. å°è£…Characterè§’è‰²æ‰®æ¼”ä»£ç å°è£… `RolyPlayingCharacterInfo`å’Œ `RolyPlayingFunction`ï¼š
     â‘ æ”¯æŒè‡ªå®šä¹‰sys_promptåŠè°ƒç”¨ï¼›
     â‘¡æ”¯æŒå‰ç«¯/åç«¯characterä¿¡æ¯è°ƒç”¨ï¼›
  2. å°è£…åŸºäºæ˜Ÿç«å¤§æ¨¡å‹çš„è§’è‰²æ‰®æ¼”å¯¹è¯ç³»ç»Ÿï¼›
  3. å°è£…åŸºäºæœ¬åœ°Clientçš„è§’è‰²æ‰®æ¼”ç³»ç»Ÿï¼›
  4. é‡æ„å‰åç«¯é€šä¿¡æ•°æ®æ ¼å¼ï¼›
- **2024.2.25**ï¼š
  1. å®Œæˆæ¿è½½å‰ç«¯ç³»ç»Ÿå’Œåç«¯æœåŠ¡å™¨å¯¹æ¥ï¼›
     â‘ è®¾ç½®å›ç­”è¡¨æƒ…ååº”ï¼›
     â‘¡è®¾ç½®è§’è‰²æ‰®æ¼”å¯¹è¯ï¼›
     â‘¢é—®é¢˜ï¼šå½“è¯­éŸ³æµå¼æ’­æ”¾æ—¶ï¼ŒåŠ¨ç”»æ’­æ”¾å¡é¡¿ï¼Œå»¶è¿Ÿé«˜ï¼›
- **2024.2.22-2.24**ï¼š
  1. å®Œæˆåç«¯æœåŠ¡å™¨å…¨æµå¼å¤šè¿›ç¨‹é«˜å¹¶å‘å¹¶å‘ç³»ç»Ÿ `TakwayApp`æ­å»ºï¼›
     â‘ å¤šçº¿ç¨‹æ”¯æŒæµå¼è·å–å¹¶è¯†åˆ«è¯­éŸ³ç‰‡æ®µï¼Œç­‰å¾…å®Œå…¨è¯†åˆ«åé€å…¥å¤§æ¨¡å‹ç”Ÿæˆéƒ¨åˆ†ï¼›
     â‘¡å¤šçº¿ç¨‹æ”¯æŒæµå¼å¤§æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼›
     â‘¢å¤šçº¿ç¨‹æ”¯æŒæµå¼è·å–å¤§æ¨¡å‹è¾“å‡ºï¼Œå¹¶è¾“å…¥åˆ°VITSç«¯æµå¼åˆæˆéŸ³é¢‘ï¼›
     â‘£æµå¼è¿”å›éŸ³é¢‘æ•°æ®ï¼Œå¹¶å®ç°æœ¬åœ°å¿«é€Ÿæ’­æ”¾ï¼›
- **2024.2.18**ï¼š
  1. æ˜Ÿç«å¤§æ¨¡å‹ä»£ç å°è£… `SparkChatClient`ï¼š
     â‘ æ”¯æŒæµå¼è¾“å‡ºï¼›
  2. VITS TTSä»£ç å°è£… `TextToSpeech`ï¼š
     â‘ æ”¯æŒæµå¼ç”ŸæˆéŸ³é¢‘ï¼›
  3. æœ¬åœ°éŸ³é¢‘æ’­æ”¾æ¨¡å—ä»£ç å°è£… `AudioPlayer`ï¼š
     â‘ æ”¯æŒVITSè¾“å‡ºæ— æŸè½¬æ¢PCMï¼›
     â‘¡æ”¯æŒæµå¼æ’­æ”¾éŸ³é¢‘ï¼›
- **2024.2.17**ï¼š
  1. æœ¬åœ°è¯­éŸ³ç³»ç»Ÿä»£ç å°è£… `PicovoiceRecorder`ï¼š
     â‘ å¢åŠ VADåŠŸèƒ½ï¼›
     â‘¡å¢åŠ  `Picovoice`çš„è¯­éŸ³å”¤é†’åŠŸèƒ½ï¼›
  2. æœ¬åœ°EMOè¡¨æƒ…ç®¡ç†æ¨¡å—ä»£ç å°è£… `EmoVideoPlayer`ï¼š
     â‘ å¢åŠ éšæœºwinkåŠŸèƒ½ï¼›
     â‘¡é¢„ç•™æœåŠ¡å™¨ç«¯è‡ªå®šä¹‰è¡¨æƒ…æ¥å£ï¼›
  3. å®Œæˆæœ¬åœ°Clientå®¢æˆ·ç«¯å¤šè¿›ç¨‹ç³»ç»Ÿæ­å»ºï¼›

</details>

---

### ğŸ“ŒåŠŸèƒ½æ”¯æŒ

- âœ… PicoVoiceè¯­éŸ³å”¤é†’
- âœ… åç«¯å…¨æµå¼æµå¼ç”Ÿæˆ
- âœ… æ”¯æŒFunASRæ¡†æ¶å’ŒModelscopeæ¨¡å‹åº“
- âœ… æ”¯æŒæœ¬åœ°æ¨¡å‹APIæ¥å…¥
- âœ… æ”¯æŒé—­æºAPIæ¨¡å‹ç»Ÿä¸€æ¥å£æ¥å…¥ @é¹¤è“
- ğŸŸ¥ ç»Ÿä¸€Logger & ErroråŸºç±» @
- âœ… FastAPIé«˜å¹¶å‘åç«¯è®¾è®¡

### ğŸ§©æ¨¡å—è®¾è®¡

```
â”œâ”€takway                            # takwayæ¡†æ¶ä¸»ç›®å½•
â”‚  â”œâ”€*.py                               # æ¨¡å—ä»£ç 
â”‚  â”œâ”€stt                                # è¯­éŸ³è¯†åˆ«sttæ¨¡å—
â”‚  â”œâ”€tts                                # è¯­éŸ³åˆæˆttsæ¨¡å—
â”‚  â”‚  â”œâ”€vits                                # vitsæ¨¡å—
â”‚  â”œâ”€llm                                # å¤§æ¨¡å‹llmæ¨¡å—
â”‚  â”œâ”€board                              # ç¡¬ä»¶æ¿è½½ç«¯æ¨¡å—
â”‚  â”œâ”€clients                            # ç¡¬ä»¶å®¢æˆ·ç«¯æ¨¡å—
â”‚  â”œâ”€apps                               # æ—§ç‰ˆåç«¯æœåŠ¡æ¨¡å—
â”‚  â”œâ”€bida                               # bidaæ¨¡å—
â”œâ”€examples                          # ç¤ºä¾‹ä»£ç 
â”œâ”€tools                             # å·¥å…·è„šæœ¬
â”œâ”€main.py                           # AIåç«¯æœåŠ¡å¯åŠ¨æ–‡ä»¶
â”œâ”€README.md                         # æœ¬è¯´æ˜æ–‡ä»¶
â”œâ”€docs                              # å¸®åŠ©æ–‡æ¡£
â”œâ”€requirements/                     # ç›¸å…³ä¾èµ–åŒ…
â”‚   â”œâ”€board_requirements.txt            # ç¡¬ä»¶æ¿è½½ç«¯ä¾èµ–
â”‚   â”œâ”€requirements.txt                  # æœåŠ¡å™¨ç«¯ä¾èµ–
â”œâ”€vits_model                        # vitsæ¨¡å‹ç›®å½•(å¿…é¡»)
â”‚  â”œâ”€config.json                        # vitsæ¨¡å‹é…ç½®æ–‡ä»¶
â”‚  â”œâ”€*.pth                              # vitsæ¨¡å‹æƒé‡æ–‡ä»¶
â”œâ”€api-for-open-llm                  # æœ¬åœ°æ¨¡å‹ç›®å½•(å¯é€‰)
â”‚  â”œâ”€models                             # æœ¬åœ°æ¨¡å‹ç›®å½•
â”‚  â”‚  â”œâ”€internlm2-chat-1_8b             # (ç¤ºä¾‹)
```

## ğŸ–¥ï¸å®‰è£…å’Œè¿è¡Œï¼š

### 1. åˆ›å»ºcondaç¯å¢ƒå¹¶å®‰è£…Pytorchï¼š

- å®‰è£…åŸºç¡€ä¾èµ–é¡¹(Linux):

```
sudo apt-get update
sudo apt-get install cmake g++ gcc portaudio19-dev
```

- Condaç¯å¢ƒå®‰è£…(Win & Linux):

```
conda create -n takway python=3.8
```

- [pytorch](https://pytorch.org/get-started/previous-versions/):

```
// å®‰è£…Pytorchï¼Œå…¶ä»–ç‰ˆæœ¬å‚ç…§ï¼šhttps://pytorch.org/get-started/previous-versions
// æœ€æ–°ç‰ˆæœ¬ï¼špip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118 
pip install torch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 --index-url https://download.pytorch.org/whl/cu118
```

- å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ï¼š

```
pip install -r requirements.txt
```

### 2. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°å¹¶å®‰è£…ä¾èµ–ï¼š

- `Takway`:

```
// å…‹éš†é¡¹ç›®åˆ°æœ¬åœ° https or ssh
git clone https://github.com/Irvingao/takway_base.git or git clone git@github.com:Irvingao/takway_base.git
cd takway_base
pip install -v -e .
```

#### (1) LLMæ¨¡å‹ä¾èµ–é¡¹å®‰è£…ï¼š

- å¦‚æœä½¿ç”¨å•†ä¸šLLM APIæœåŠ¡ï¼ˆå¦‚minimaxç­‰ï¼‰:

  - æ— éœ€å®‰è£…ä¾èµ–é¡¹ï¼Œç›´æ¥è¿›å…¥[3. ä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶æ­¥éª¤](#3-ä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶)ã€‚



- å¦‚æœä½¿ç”¨å•†ä¸šLLM bida APIï¼ˆä¸ä½¿ç”¨åˆ™è·³è¿‡ï¼‰:
  <details>
  <summary>ç‚¹å‡»å±•å¼€å®‰è£…ç»†èŠ‚</summary>

  - `bida`:

  ```
  pip install -r bida/requirements.txt
  cd bida
  # pip install -e .
  ```
  </details>

- å¦‚æœä½¿ç”¨æœ¬åœ°LLMæ¨¡å‹ï¼ˆä¸ä½¿ç”¨åˆ™è·³è¿‡ï¼‰ï¼š
  <details>
  <summary>ç‚¹å‡»å±•å¼€å®‰è£…ç»†èŠ‚</summary>
  - `api-for-open-llm`:

  ```
  git clone https://github.com/xusenlinzy/api-for-open-llm.git
  ```

  - å®‰è£…vllm-cuda118ç‰ˆæœ¬ï¼š

  ```
    pip install vllm==0.3.3
    export VLLM_VERSION=0.3.2
    export PYTHON_VERSION=38
    pip install https://github.com/vllm-project/vllm/releases/download/v${VLLM_VERSION}/vllm-${VLLM_VERSION}+cu118-cp${PYTHON_VERSION}-cp${PYTHON_VERSION}-manylinux1_x86_64.whl
    # Re-install xFormers with CUDA 11.8.
    pip install xformers==0.0.23.post1+cu118 --index-url https://download.pytorch.org/whl/cu118 --no-deps
  ```

  - å®‰è£…å…¶ä»–ä¾èµ–é¡¹ï¼š

  ```
    pip install -r api-for-open-llm/requirements.txt
    pip uninstall transformer-engine -y
  ```

  </details>

### 3. ä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶:

- VITSè¯­éŸ³åˆæˆæ¨¡å‹ï¼ˆå¿…é¡»ï¼‰ï¼š[vits-uma-genshin-honkai](https://huggingface.co/spaces/zomehwh/vits-uma-genshin-honkai/tree/main)

  ```
  // ä¸‹è½½VITSè¯­éŸ³åˆæˆæ¨¡å‹
  git lfs install
  git clone https://huggingface.co/spaces/zomehwh/vits-uma-genshin-honkai.git
  ```
- InternLMæ¨¡å‹ï¼ˆå¯é€‰ï¼‰ï¼š[internlm2-chat-1_8b](https://www.modelscope.cn/models/jayhust/internlm2-chat-1_8b/summary)
  <details>
  <summary>ç‚¹å‡»å±•å¼€ä¸‹è½½ç»†èŠ‚</summary>

  ```
  // ä¸‹è½½InternLMæ¨¡å‹(Linux: `apt-get install git-lfs`)
  git lfs install
  git clone https://www.modelscope.cn/jayhust/internlm2-chat-1_8b.git
  ```
  </details>

### 4. è¿è¡Œé¡¹ç›®ï¼š

#### (1) æœåŠ¡å™¨åç«¯(Linux)ï¼š

> åç«¯å¯ä»¥éƒ¨ç½²åœ¨å…·æœ‰GPUçš„äº‘ç«¯/æœ¬åœ°æœºå™¨ä¸Šã€‚

- **å¯åŠ¨åç«¯æœåŠ¡**:

  ```
  python main.py
  ```

#### (2) ç¡¬ä»¶å®¢æˆ·ç«¯(Windows/Linux)ï¼š
- **å¯åŠ¨ç¡¬ä»¶äº¤äº’å‰ç«¯æœåŠ¡**:

  ```
  python local_client.py
  ```
